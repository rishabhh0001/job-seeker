{% extends 'base.html' %}
{% load humanize %}
{% block title %}Find Your Dream Job - JobPortal{% endblock %}

{% block content %}
<!-- Hero Section -->
<section class="hero-section text-center position-relative" id="hero-animate">
    <!-- Vanta JS canvas will be appended here automatically -->
    <div class="hero-shape" style="top: -100px; left: -100px;"></div>
    <div class="hero-shape"
        style="bottom: -100px; right: -100px; background: radial-gradient(circle, var(--accent) 0%, transparent 70%);">
    </div>

    <div class="container position-relative z-1" data-aos="fade-up">
        <h1 class="display-3 fw-bold mb-4">Find Your <span class="text-primary-gradient">Dream Job</span> Today</h1>
        <p class="lead text-white-50 mb-5 mx-auto" style="max-width: 600px;">
            Browse thousands of job openings from top companies and startups. Your next big career move starts here.
        </p>

        <div class="search-box mx-auto p-2 rounded-pill shadow-lg d-flex flex-wrap flex-md-nowrap align-items-center"
            style="max-width: 800px;">
            <form method="get" action="." class="d-flex w-100 flex-wrap flex-md-nowrap">
                <div class="flex-grow-1 border-end-md px-3 py-2 w-100 w-md-auto position-relative">
                    <div class="input-group">
                        <span class="input-group-text bg-transparent border-0"><i
                                class="fas fa-search text-muted"></i></span>
                        <input type="text" name="query" id="job-search-input" class="form-control border-0 shadow-none"
                            placeholder="Job title, keywords..." value="{{ current_query }}" autocomplete="off">
                    </div>
                    <div id="job-autocomplete-list" class="autocomplete-items"></div>
                </div>
                <div class="flex-grow-1 px-3 py-2 w-100 w-md-auto position-relative">
                    <div class="input-group">
                        <span class="input-group-text bg-transparent border-0"><i
                                class="fas fa-map-marker-alt text-muted"></i></span>
                        <input type="text" name="location" id="location-search-input"
                            class="form-control border-0 shadow-none" placeholder="Location"
                            value="{{ current_location }}" autocomplete="off">
                    </div>
                    <div id="location-autocomplete-list" class="autocomplete-items"></div>
                </div>
                <div class="p-1 w-100 w-md-auto">
                    <button type="submit" class="btn btn-primary rounded-pill w-100 h-100 px-4 fw-bold">Search</button>
                </div>
            </form>
        </div>

        <div class="mt-4 text-white-50 small">
            Popular: <a href="?query=Designer" class="text-white-50 text-decoration-underline mx-1">Designer</a>
            <a href="?query=Developer" class="text-white-50 text-decoration-underline mx-1">Developer</a>
            <a href="?query=Marketing" class="text-white-50 text-decoration-underline mx-1">Marketing</a>
        </div>
    </div>
</section>

<!-- Stats / Categories -->
<section class="py-5">
    <div class="container">
        <div class="row g-4 text-center">
            {% for cat in categories|slice:":4" %}
            <div class="col-md-3 col-6" data-aos="fade-up" data-aos-delay="{{ forloop.counter|add:'100' }}">
                <a href="?category={{ cat.slug }}" class="card h-100 p-4 text-decoration-none hover-shadow">
                    <div class="display-6 mb-3 text-primary">
                        <i class="fas fa-layer-group"></i> <!-- Dynamic icons would be better -->
                    </div>
                    <h5 class="fw-bold">{{ cat.name }}</h5>
                    <p class="text-muted small mb-0">{{ cat.jobs.count }} Openings</p>
                </a>
            </div>
            {% empty %}
            <!-- Placeholder if no categories -->
            <div class="col-12 text-center text-muted">No categories defined yet.</div>
            {% endfor %}
        </div>
    </div>
</section>

<!-- Job Listings -->
<section class="py-5">
    <div class="container">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h3 class="fw-bold section-title">Latest <span class="text-primary-gradient">Jobs</span></h3>
            <span class="text-muted">{{ page_obj.paginator.count }} jobs found</span>
        </div>

        <div class="row">
            <div class="col-lg-12">
                {% for job in jobs %}
                <div class="card mb-3 job-card js-tilt" data-aos="fade-up">
                    <div class="card-body p-4 d-flex flex-column flex-md-row align-items-center gap-4">
                        <div class="flex-shrink-0">
                            <div class="avatar-lg rounded text-center d-flex align-items-center justify-content-center"
                                style="width: 60px; height: 60px;">
                                <i class="fas fa-building fa-2x text-muted"></i>
                            </div>
                        </div>
                        <div class="flex-grow-1 text-center text-md-start">
                            <h5 class="fw-bold mb-1"><a href="{% url 'job_detail' job.slug %}"
                                    class="text-main text-decoration-none stretched-link">{{ job.title }}</a></h5>
                            <div class="text-muted mb-2">
                                <span class="fw-medium text-main">{{ job.employer.company_name|default:"Confidential"
                                    }}</span> &bull;
                                <span class="small"><i class="fas fa-map-marker-alt me-1"></i>{{ job.location }}</span>
                            </div>
                            <div class="d-flex flex-wrap justify-content-center justify-content-md-start gap-2">
                                <span class="badge badge-soft-primary">{{ job.get_job_type_display }}</span>
                                <span class="badge border">{{ job.category.name|default:"General"
                                    }}</span>
                                <span class="text-success small fw-bold">
                                    {% if job.salary_min %}
                                    ${{ job.salary_min|intcomma }} - ${{ job.salary_max|intcomma }}
                                    {% endif %}
                                </span>
                            </div>
                        </div>
                        <div class="flex-shrink-0 text-end">
                            <small class="text-muted d-block mb-2">{{ job.created_at|timesince }} ago</small>
                            <a href="{% url 'job_detail' job.slug %}"
                                class="btn btn-outline-primary btn-sm rounded-pill px-4 position-relative"
                                style="z-index: 2;">Apply Now</a>
                        </div>
                    </div>
                </div>
                {% empty %}
                <div class="text-center py-5">
                    <img src="https://cdni.iconscout.com/illustration/premium/thumb/no-data-found-8867280-7265556.png?f=webp"
                        alt="No jobs" style="width: 200px; opacity: 0.7;">
                    <p class="mt-3 text-muted">No jobs found matching your criteria.</p>
                </div>
                {% endfor %}

                <!-- Pagination -->
                {% if is_paginated %}
                <nav class="mt-5">
                    <ul class="pagination justify-content-center">
                        {% if page_obj.has_previous %}
                        <li class="page-item"><a class="page-link"
                                href="?page={{ page_obj.previous_page_number }}">&laquo;</a></li>
                        {% endif %}

                        <li class="page-item active"><span class="page-link">{{ page_obj.number }}</span></li>

                        {% if page_obj.has_next %}
                        <li class="page-item"><a class="page-link"
                                href="?page={{ page_obj.next_page_number }}">&raquo;</a></li>
                        {% endif %}
                    </ul>
                </nav>
                {% endif %}
            </div>
        </div>
    </div>
</section>
{% endblock %}